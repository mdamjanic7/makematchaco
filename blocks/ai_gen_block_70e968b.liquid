{% doc %}
  @prompt
    Create a marquee section that displays press logos scrolling horizontally across the page. This is an infinite scroll and transitions between every loop should be seamless. The section should allow merchants to upload multiple press/media outlet logos that continuously scroll from right to left in a smooth, infinite loop. Include settings to control scroll speed, logo size, and spacing between logos. The design should be clean and professional to showcase brand credibility., make it go full width
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-press-marquee-{{ ai_gen_id }} {
    display: block;
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    overflow: hidden;
    padding: {{ block.settings.section_padding_top }}px 0 {{ block.settings.section_padding_bottom }}px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-press-marquee__sr-only-{{ ai_gen_id }} {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .ai-press-marquee__container-{{ ai_gen_id }} {
    width: 100%;
    max-width: 100%;
  }

  .ai-press-marquee__heading-{{ ai_gen_id }} {
    text-align: center;
    margin: 0 0 {{ block.settings.heading_spacing }}px;
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.heading_size }}px;
  }

  .ai-press-marquee__track-{{ ai_gen_id }} {
    display: flex;
    width: max-content;
    animation: ai-press-marquee-scroll-{{ ai_gen_id }} {{ block.settings.scroll_speed }}s linear infinite;
  }

  .ai-press-marquee__track-{{ ai_gen_id }}:hover {
    animation-play-state: {% if block.settings.pause_on_hover %}paused{% else %}running{% endif %};
  }

  .ai-press-marquee__item-{{ ai_gen_id }} {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    height: {{ block.settings.logo_height }}px;
    margin-right: {{ block.settings.logo_spacing }}px;
  }

  .ai-press-marquee__logo-{{ ai_gen_id }} {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    filter: grayscale({{ block.settings.grayscale_amount }}%);
    opacity: {{ block.settings.logo_opacity | divided_by: 100.0 }};
    transition: filter 0.3s ease, opacity 0.3s ease;
  }

  .ai-press-marquee__item-{{ ai_gen_id }}:hover .ai-press-marquee__logo-{{ ai_gen_id }} {
    filter: grayscale(0%);
    opacity: 1;
  }

  .ai-press-marquee__placeholder-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    justify-content: center;
    width: {{ block.settings.logo_height | times: 1.5 }}px;
    height: {{ block.settings.logo_height }}px;
    background-color: #f4f4f4;
    border-radius: 4px;
  }

  .ai-press-marquee__placeholder-{{ ai_gen_id }} svg {
    width: 50%;
    height: 50%;
    opacity: 0.3;
  }

  @keyframes ai-press-marquee-scroll-{{ ai_gen_id }} {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  @media screen and (max-width: 749px) {
    .ai-press-marquee__item-{{ ai_gen_id }} {
      height: {{ block.settings.logo_height_mobile }}px;
    }

    .ai-press-marquee__placeholder-{{ ai_gen_id }} {
      width: {{ block.settings.logo_height_mobile | times: 1.5 }}px;
      height: {{ block.settings.logo_height_mobile }}px;
    }

    .ai-press-marquee__heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.8 }}px;
    }
  }
{% endstyle %}

<press-marquee-{{ ai_gen_id }} class="ai-press-marquee-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-press-marquee__container-{{ ai_gen_id }}">
    {% if block.settings.heading != blank %}
      <h2 class="ai-press-marquee__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
    {% endif %}

    {%- comment -%} Screen reader accessible list of logos {%- endcomment -%}
    <ul class="ai-press-marquee__sr-only-{{ ai_gen_id }}">
      {% for i in (1..12) %}
        {% assign logo_key = 'logo_' | append: i %}
        {% assign logo = block.settings[logo_key] %}
        {% if logo != blank %}
          <li>{{ logo.alt | default: 'Press logo' | escape }}</li>
        {% endif %}
      {% endfor %}
    </ul>

    <div class="ai-press-marquee__track-{{ ai_gen_id }}" aria-hidden="true">
      {% liquid
        assign logos_array = ''
        for i in (1..12)
          assign logo_key = 'logo_' | append: i
          assign logo = block.settings[logo_key]
          if logo != blank
            assign logos_array = logos_array | append: i | append: ','
          endif
        endfor
        assign logos_array = logos_array | split: ','
        assign logos_count = logos_array.size
      %}

      {% if logos_count > 0 %}
        {%- comment -%} Duplicate logos enough times to ensure seamless scrolling {%- endcomment -%}
        {% for iteration in (1..4) %}
          {% for i in (1..12) %}
            {% assign logo_key = 'logo_' | append: i %}
            {% assign logo = block.settings[logo_key] %}
            {% if logo != blank %}
              <div class="ai-press-marquee__item-{{ ai_gen_id }}">
                <img
                  src="{{ logo | image_url: width: 400 }}"
                  alt=""
                  class="ai-press-marquee__logo-{{ ai_gen_id }}"
                  loading="lazy"
                  width="{{ logo.width }}"
                  height="{{ logo.height }}"
                >
              </div>
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% else %}
        {%- comment -%} Show placeholder logos if none uploaded {%- endcomment -%}
        {% for iteration in (1..4) %}
          {% for i in (1..6) %}
            <div class="ai-press-marquee__item-{{ ai_gen_id }}">
              <div class="ai-press-marquee__placeholder-{{ ai_gen_id }}">
                {{ 'image' | placeholder_svg_tag }}
              </div>
            </div>
          {% endfor %}
        {% endfor %}
      {% endif %}
    </div>
  </div>
</press-marquee-{{ ai_gen_id }}>

<script>
  (function() {
    class PressMarquee{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.track = this.querySelector('.ai-press-marquee__track-{{ ai_gen_id }}');
        this.init();
      }

      init() {
        if (!this.track) return;
        
        // Wait for images to load before calculating
        const images = this.track.querySelectorAll('img');
        if (images.length > 0) {
          Promise.all(
            Array.from(images).map(img => {
              if (img.complete) return Promise.resolve();
              return new Promise(resolve => {
                img.addEventListener('load', resolve);
                img.addEventListener('error', resolve);
              });
            })
          ).then(() => {
            this.adjustAnimationSpeed();
          });
        } else {
          this.adjustAnimationSpeed();
        }
      }

      adjustAnimationSpeed() {
        if (!this.track) return;
        
        // Get the width of half the track (since we animate to -50%)
        // This works because we duplicate logos 4 times, so halfway = 2 complete sets
        const halfTrackWidth = this.track.scrollWidth / 2;
        const speed = {{ block.settings.scroll_speed }};
        
        // Calculate duration based on track width and speed setting
        // Higher speed value = slower animation (more seconds)
        const duration = (halfTrackWidth / 100) * (speed / 10);
        this.track.style.animationDuration = duration + 's';
      }
    }

    customElements.define('press-marquee-{{ ai_gen_id }}', PressMarquee{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Press marquee",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "Heading",
      "default": "As featured in"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading size",
      "min": 12,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "heading_spacing",
      "label": "Heading spacing",
      "min": 0,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "header",
      "content": "Logos"
    },
    {
      "type": "image_picker",
      "id": "logo_1",
      "label": "Logo 1"
    },
    {
      "type": "image_picker",
      "id": "logo_2",
      "label": "Logo 2"
    },
    {
      "type": "image_picker",
      "id": "logo_3",
      "label": "Logo 3"
    },
    {
      "type": "image_picker",
      "id": "logo_4",
      "label": "Logo 4"
    },
    {
      "type": "image_picker",
      "id": "logo_5",
      "label": "Logo 5"
    },
    {
      "type": "image_picker",
      "id": "logo_6",
      "label": "Logo 6"
    },
    {
      "type": "image_picker",
      "id": "logo_7",
      "label": "Logo 7"
    },
    {
      "type": "image_picker",
      "id": "logo_8",
      "label": "Logo 8"
    },
    {
      "type": "image_picker",
      "id": "logo_9",
      "label": "Logo 9"
    },
    {
      "type": "image_picker",
      "id": "logo_10",
      "label": "Logo 10"
    },
    {
      "type": "image_picker",
      "id": "logo_11",
      "label": "Logo 11"
    },
    {
      "type": "image_picker",
      "id": "logo_12",
      "label": "Logo 12"
    },
    {
      "type": "header",
      "content": "Logo style"
    },
    {
      "type": "range",
      "id": "logo_height",
      "label": "Desktop height",
      "min": 20,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "logo_height_mobile",
      "label": "Mobile height",
      "min": 20,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "logo_spacing",
      "label": "Spacing between logos",
      "min": 20,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "grayscale_amount",
      "label": "Grayscale",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "%",
      "default": 100
    },
    {
      "type": "range",
      "id": "logo_opacity",
      "label": "Opacity",
      "min": 10,
      "max": 100,
      "step": 10,
      "unit": "%",
      "default": 60
    },
    {
      "type": "header",
      "content": "Animation"
    },
    {
      "type": "range",
      "id": "scroll_speed",
      "label": "Scroll speed",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "s",
      "default": 30
    },
    {
      "type": "checkbox",
      "id": "pause_on_hover",
      "label": "Pause on hover",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Press marquee"
    }
  ]
}
{% endschema %}
