{% doc %}
  @prompt
    Create a variant picker customization that allows assigning different hex colors to each variant type (e.g., different colors for size variants vs. color variants, or different colors for specific variant options). The code should allow merchants to easily configure which variant types or options get which hex colors, and apply those colors to the variant picker buttons including background, text, and border colors.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-variant-picker-{{ ai_gen_id }} {
    display: block;
    width: 100%;
  }

  .ai-variant-picker__container-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
  }

  .ai-variant-picker__option-group-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .ai-variant-picker__label-{{ ai_gen_id }} {
    font-size: {{ block.settings.label_font_size }}px;
    font-weight: 600;
    color: {{ block.settings.label_color }};
    margin: 0;
  }

  .ai-variant-picker__buttons-{{ ai_gen_id }} {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .ai-variant-picker__button-{{ ai_gen_id }} {
    padding: {{ block.settings.button_padding }}px {{ block.settings.button_padding | times: 1.5 }}px;
    font-size: {{ block.settings.button_font_size }}px;
    border-radius: {{ block.settings.button_border_radius }}px;
    cursor: pointer;
    transition: all 0.2s ease;
    border-width: {{ block.settings.button_border_width }}px;
    border-style: solid;
    background: none;
    font-family: inherit;
    min-width: 60px;
    text-align: center;
  }

  .ai-variant-picker__button-{{ ai_gen_id }}:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option1"] {
    background-color: {{ block.settings.option1_bg_color }};
    color: {{ block.settings.option1_text_color }};
    border-color: {{ block.settings.option1_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option1"]:hover:not(:disabled) {
    background-color: {{ block.settings.option1_hover_bg_color }};
    color: {{ block.settings.option1_hover_text_color }};
    border-color: {{ block.settings.option1_hover_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option1"].active {
    background-color: {{ block.settings.option1_selected_bg_color }};
    color: {{ block.settings.option1_selected_text_color }};
    border-color: {{ block.settings.option1_selected_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option2"] {
    background-color: {{ block.settings.option2_bg_color }};
    color: {{ block.settings.option2_text_color }};
    border-color: {{ block.settings.option2_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option2"]:hover:not(:disabled) {
    background-color: {{ block.settings.option2_hover_bg_color }};
    color: {{ block.settings.option2_hover_text_color }};
    border-color: {{ block.settings.option2_hover_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option2"].active {
    background-color: {{ block.settings.option2_selected_bg_color }};
    color: {{ block.settings.option2_selected_text_color }};
    border-color: {{ block.settings.option2_selected_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option3"] {
    background-color: {{ block.settings.option3_bg_color }};
    color: {{ block.settings.option3_text_color }};
    border-color: {{ block.settings.option3_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option3"]:hover:not(:disabled) {
    background-color: {{ block.settings.option3_hover_bg_color }};
    color: {{ block.settings.option3_hover_text_color }};
    border-color: {{ block.settings.option3_hover_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="option3"].active {
    background-color: {{ block.settings.option3_selected_bg_color }};
    color: {{ block.settings.option3_selected_text_color }};
    border-color: {{ block.settings.option3_selected_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="default"] {
    background-color: {{ block.settings.default_bg_color }};
    color: {{ block.settings.default_text_color }};
    border-color: {{ block.settings.default_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="default"]:hover:not(:disabled) {
    background-color: {{ block.settings.default_hover_bg_color }};
    color: {{ block.settings.default_hover_text_color }};
    border-color: {{ block.settings.default_hover_border_color }};
  }

  .ai-variant-picker__button-{{ ai_gen_id }}[data-custom-color="default"].active {
    background-color: {{ block.settings.default_selected_bg_color }};
    color: {{ block.settings.default_selected_text_color }};
    border-color: {{ block.settings.default_selected_border_color }};
  }

  .ai-variant-picker__selected-variant-{{ ai_gen_id }} {
    margin-top: 20px;
    padding: 15px;
    background-color: {{ block.settings.info_bg_color }};
    border-radius: {{ block.settings.button_border_radius }}px;
    color: {{ block.settings.info_text_color }};
  }

  .ai-variant-picker__selected-variant-{{ ai_gen_id }} p {
    margin: 5px 0;
    font-size: 14px;
  }

  .ai-variant-picker__selected-variant-{{ ai_gen_id }} strong {
    font-weight: 600;
  }

  @media screen and (max-width: 749px) {
    .ai-variant-picker__button-{{ ai_gen_id }} {
      min-width: 50px;
      padding: {{ block.settings.button_padding | times: 0.8 }}px {{ block.settings.button_padding | times: 1.2 }}px;
    }
  }
{% endstyle %}

<variant-picker-{{ ai_gen_id }}
  class="ai-variant-picker-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
  data-product-id="{{ product.id }}"
>
  <div class="ai-variant-picker__container-{{ ai_gen_id }}">
    {% if product.has_only_default_variant %}
      <p>This product has no variants.</p>
    {% else %}
      {% for option in product.options_with_values %}
        <div class="ai-variant-picker__option-group-{{ ai_gen_id }}">
          <label class="ai-variant-picker__label-{{ ai_gen_id }}">
            {{ option.name }}
          </label>
          <div class="ai-variant-picker__buttons-{{ ai_gen_id }}">
            {% for value in option.values %}
              {% liquid
                assign option_index = option.position
                assign color_scheme = 'default'
                
                if block.settings.option1_name != blank and option.name == block.settings.option1_name
                  assign color_scheme = 'option1'
                elsif block.settings.option2_name != blank and option.name == block.settings.option2_name
                  assign color_scheme = 'option2'
                elsif block.settings.option3_name != blank and option.name == block.settings.option3_name
                  assign color_scheme = 'option3'
                endif
                
                assign is_selected = false
                if option_index == 1 and product.selected_or_first_available_variant.option1 == value
                  assign is_selected = true
                elsif option_index == 2 and product.selected_or_first_available_variant.option2 == value
                  assign is_selected = true
                elsif option_index == 3 and product.selected_or_first_available_variant.option3 == value
                  assign is_selected = true
                endif
              %}
              <button
                type="button"
                class="ai-variant-picker__button-{{ ai_gen_id }} {% if is_selected %}active{% endif %}"
                data-option-position="{{ option.position }}"
                data-option-value="{{ value | escape }}"
                data-custom-color="{{ color_scheme }}"
              >
                {{ value }}
              </button>
            {% endfor %}
          </div>
        </div>
      {% endfor %}

      {% if block.settings.show_selected_info %}
        <div class="ai-variant-picker__selected-variant-{{ ai_gen_id }}">
          <p><strong>Selected:</strong> <span data-selected-title>{{ product.selected_or_first_available_variant.title }}</span></p>
          <p><strong>Price:</strong> <span data-selected-price>{{ product.selected_or_first_available_variant.price | money }}</span></p>
          {% if product.selected_or_first_available_variant.available %}
            <p><strong>Status:</strong> <span data-selected-availability>In stock</span></p>
          {% else %}
            <p><strong>Status:</strong> <span data-selected-availability>Out of stock</span></p>
          {% endif %}
        </div>
      {% endif %}
    {% endif %}
  </div>
</variant-picker-{{ ai_gen_id }}>

<script>
  (function() {
    class VariantPicker{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.product = null;
        this.selectedOptions = {};
      }

      connectedCallback() {
        this.productId = this.dataset.productId;
        this.buttons = this.querySelectorAll('.ai-variant-picker__button-{{ ai_gen_id }}');
        this.fetchProductData();
        this.setupEventListeners();
      }

      async fetchProductData() {
        try {
          const response = await fetch(`/products/${window.location.pathname.split('/').pop()}.js`);
          this.product = await response.json();
          this.initializeSelectedOptions();
          this.updateAvailability();
        } catch (error) {
          console.error('Error fetching product data:', error);
        }
      }

      initializeSelectedOptions() {
        this.buttons.forEach(button => {
          if (button.classList.contains('active')) {
            const position = button.dataset.optionPosition;
            const value = button.dataset.optionValue;
            this.selectedOptions[position] = value;
          }
        });
      }

      setupEventListeners() {
        this.buttons.forEach(button => {
          button.addEventListener('click', (e) => {
            const clickedButton = e.currentTarget;
            const position = clickedButton.dataset.optionPosition;
            const value = clickedButton.dataset.optionValue;

            this.querySelectorAll(`[data-option-position="${position}"]`).forEach(btn => {
              btn.classList.remove('active');
            });

            clickedButton.classList.add('active');
            this.selectedOptions[position] = value;

            this.updateVariant();
          });
        });
      }

      updateVariant() {
        if (!this.product) return;

        const selectedVariant = this.product.variants.find(variant => {
          return variant.option1 === this.selectedOptions['1'] &&
                 (variant.option2 === this.selectedOptions['2'] || !this.selectedOptions['2']) &&
                 (variant.option3 === this.selectedOptions['3'] || !this.selectedOptions['3']);
        });

        if (selectedVariant) {
          this.updateURL(selectedVariant.id);
          this.updateSelectedInfo(selectedVariant);
          this.updateAvailability();
        }
      }

      updateURL(variantId) {
        const url = new URL(window.location.href);
        url.searchParams.set('variant', variantId);
        window.history.replaceState({}, '', url);
      }

      updateSelectedInfo(variant) {
        const titleElement = this.querySelector('[data-selected-title]');
        const priceElement = this.querySelector('[data-selected-price]');
        const availabilityElement = this.querySelector('[data-selected-availability]');

        if (titleElement) {
          titleElement.textContent = variant.title;
        }

        if (priceElement) {
          priceElement.textContent = this.formatMoney(variant.price);
        }

        if (availabilityElement) {
          availabilityElement.textContent = variant.available ? 'In stock' : 'Out of stock';
        }
      }

      updateAvailability() {
        if (!this.product) return;

        this.buttons.forEach(button => {
          const position = button.dataset.optionPosition;
          const value = button.dataset.optionValue;

          const testOptions = {...this.selectedOptions};
          testOptions[position] = value;

          const isAvailable = this.product.variants.some(variant => {
            return variant.option1 === testOptions['1'] &&
                   (variant.option2 === testOptions['2'] || !testOptions['2']) &&
                   (variant.option3 === testOptions['3'] || !testOptions['3']) &&
                   variant.available;
          });

          button.disabled = !isAvailable;
        });
      }

      formatMoney(cents) {
        const amount = (cents / 100).toFixed(2);
        return `$${amount}`;
      }
    }

    customElements.define('variant-picker-{{ ai_gen_id }}', VariantPicker{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Custom variant picker",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Option name mapping"
    },
    {
      "type": "paragraph",
      "content": "Enter the exact option names (e.g., Size, Color, Material) to apply custom colors. Leave blank to use default colors."
    },
    {
      "type": "text",
      "id": "option1_name",
      "label": "Option 1 name"
    },
    {
      "type": "text",
      "id": "option2_name",
      "label": "Option 2 name"
    },
    {
      "type": "text",
      "id": "option3_name",
      "label": "Option 3 name"
    },
    {
      "type": "header",
      "content": "General style"
    },
    {
      "type": "range",
      "id": "label_font_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Label font size",
      "default": 16
    },
    {
      "type": "color",
      "id": "label_color",
      "label": "Label color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "button_font_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Button font size",
      "default": 14
    },
    {
      "type": "range",
      "id": "button_padding",
      "min": 6,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Button padding",
      "default": 10
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Button border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "button_border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Button border width",
      "default": 1
    },
    {
      "type": "header",
      "content": "Option 1 colors"
    },
    {
      "type": "color",
      "id": "option1_bg_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "option1_text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "option1_border_color",
      "label": "Border",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "option1_hover_bg_color",
      "label": "Hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "option1_hover_text_color",
      "label": "Hover text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "option1_hover_border_color",
      "label": "Hover border",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "option1_selected_bg_color",
      "label": "Selected background",
      "default": "#6b7fff"
    },
    {
      "type": "color",
      "id": "option1_selected_text_color",
      "label": "Selected text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "option1_selected_border_color",
      "label": "Selected border",
      "default": "#6b7fff"
    },
    {
      "type": "header",
      "content": "Option 2 colors"
    },
    {
      "type": "color",
      "id": "option2_bg_color",
      "label": "Background",
      "default": "#f7f6ee"
    },
    {
      "type": "color",
      "id": "option2_text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "option2_border_color",
      "label": "Border",
      "default": "#d0d0d0"
    },
    {
      "type": "color",
      "id": "option2_hover_bg_color",
      "label": "Hover background",
      "default": "#e8d5c7"
    },
    {
      "type": "color",
      "id": "option2_hover_text_color",
      "label": "Hover text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "option2_hover_border_color",
      "label": "Hover border",
      "default": "#b8b8b8"
    },
    {
      "type": "color",
      "id": "option2_selected_bg_color",
      "label": "Selected background",
      "default": "#780406"
    },
    {
      "type": "color",
      "id": "option2_selected_text_color",
      "label": "Selected text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "option2_selected_border_color",
      "label": "Selected border",
      "default": "#780406"
    },
    {
      "type": "header",
      "content": "Option 3 colors"
    },
    {
      "type": "color",
      "id": "option3_bg_color",
      "label": "Background",
      "default": "#2a170a"
    },
    {
      "type": "color",
      "id": "option3_text_color",
      "label": "Text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "option3_border_color",
      "label": "Border",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "option3_hover_bg_color",
      "label": "Hover background",
      "default": "#3d2210"
    },
    {
      "type": "color",
      "id": "option3_hover_text_color",
      "label": "Hover text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "option3_hover_border_color",
      "label": "Hover border",
      "default": "#888888"
    },
    {
      "type": "color",
      "id": "option3_selected_bg_color",
      "label": "Selected background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "option3_selected_text_color",
      "label": "Selected text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "option3_selected_border_color",
      "label": "Selected border",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Default colors"
    },
    {
      "type": "paragraph",
      "content": "Applied to options that don't match any configured option names"
    },
    {
      "type": "color",
      "id": "default_bg_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "default_text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "default_border_color",
      "label": "Border",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "default_hover_bg_color",
      "label": "Hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "default_hover_text_color",
      "label": "Hover text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "default_hover_border_color",
      "label": "Hover border",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "default_selected_bg_color",
      "label": "Selected background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "default_selected_text_color",
      "label": "Selected text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "default_selected_border_color",
      "label": "Selected border",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Selected variant info"
    },
    {
      "type": "checkbox",
      "id": "show_selected_info",
      "label": "Show selected variant info",
      "default": true
    },
    {
      "type": "color",
      "id": "info_bg_color",
      "label": "Info background",
      "default": "#f7f6ee"
    },
    {
      "type": "color",
      "id": "info_text_color",
      "label": "Info text",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "Custom variant picker"
    }
  ]
}
{% endschema %}
